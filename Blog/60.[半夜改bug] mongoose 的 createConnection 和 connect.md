# [åŠå¤œæ”¹bug] mongoose çš„ createConnection å’Œ connect

> ä»£ç å‡º bug å¤§åŠå¤œçš„è¢« mongoose çš„è¿æ¥å‡½æ•°ææƒ¨

å› ä¸ºä»£ç é‡Œ mongo æ•°æ®åº“çš„è¿æ¥æ–¹å¼çš„ä»£ç è¢«æ”¹æˆäº† `const db = mongoose.createConnection(mongo.url(), mongoOptions)`ï¼Œæ‰€ä»¥åœ¨è°ƒç”¨æ•°æ®æ’å…¥å‡½æ•°æ—¶ `Promise` çš„ resolve å’Œ reject éƒ½æ²¡æœ‰è¿”å›ï¼Œä¹Ÿæ²¡æœ‰æ‰“å°ä»»ä½•å¼‚å¸¸ä¿¡æ¯ã€‚

æŸ¥äº†ä¸šåŠ¡é€»è¾‘ã€æœ¬åœ° mongo çš„è¯»å†™éƒ½æ²¡é—®é¢˜ï¼Œæœ€åå‘ç°æ˜¯ mongo çš„è¿æ¥æ–‡ä»¶ connect.js è¢«ä¿®æ”¹äº†ã€‚

å› ä¸ºç”¨äº† `mongoose.createConnection` æ‰€ä»¥æ­¤æ—¶çš„ model åº”è¯¥æ˜¯ `db.mongoose.model('Product')`

è€Œä¹‹å‰çš„æ˜¯ç”¨é»˜è®¤çš„ `mongoose.connect()` æ–¹å¼è¿æ¥çš„æ•°æ®åº“ï¼Œè·å– model çš„ä»£ç ä¹Ÿåº”è¯¥æ˜¯ `const ProductModel = db.mongoose.model('Product', ProductSchema)`

æ•°æ®åº“çš„é“¾æ¥æ–¹å¼è¢«æ”¹äº†ï¼Œmodel æ²¡æœ‰å˜ï¼Œæ‰€ä»¥å¢åˆ æ”¹æŸ¥çš„ä»£ç ä¸€ç›´è¢«æŒ‚èµ·ï¼Œæ²¡æœ‰ä»»ä½•çš„è¿”å›ã€‚ğŸ˜‚ğŸ˜‚ğŸ˜‚


## APIå’Œç¤ºä¾‹ä»£ç 

### Mongoose#connect

API

> Opens the default mongoose connection.

`Mongoose#connect` å¼€å¯é»˜è®¤çš„ mongoose è¿æ¥ã€‚å¦‚æœåªè¿æ¥ä¸€ä¸ªåº“ï¼Œå°±ç”¨è¿™ä¸ªé»˜è®¤çš„ã€‚

1.è¿æ¥æ•°æ®åº“ mongo.js

```js
const db = mongoose.connect(mongo.url(), mongoOptions)
exports.mongoose = db
```

2. CRUDæ“ä½œ

```js
const db = require('./mongo.js')
const NameSchema = new Schema({
  name: String
})

const NameModel = db.mongoose.model('Name', NameSchema)

class NameDAO = {
  ...
}
```


### Mongoose#createConnection

APIé‡Œæ˜¯è¿™æ ·å†™çš„

> Each connection instance maps to a single database. This method is helpful when mangaging multiple db connections.

`Mongoose#createConnection` æ˜¯é€‚åˆäºå¤šä¸ªæ•°æ®åº“è¿æ¥çš„æ–¹å¼

1.è¿æ¥æ•°æ®åº“ mongo.js

```js
const db = mongoose.createConnection(mongo.url(), mongoOptions)
const Schema = mongoose.Schema
const NameSchema = new Schema({
  name: String
})
db.model('Name', NameSchema)
exports.mongoose = db
```

2. CRUDæ“ä½œ

```js
const db = require('./mongo.js')
const NameModel = db.mongoose.model('Name')

class NameDAO = {
  ...
}
```


## æœ€å

è¦å¤šçœ‹ API æ–‡æ¡£ ã€‚ã€‚ã€‚ã€‚


